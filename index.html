<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/th.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- р╣Ар╕Юр╕┤р╣Ир╕б Bootstrap JS р╕кр╕│р╕лр╕гр╕▒р╕Ъ Modal -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <?!= include('Stylesheet'); ?>
    
  </head>
  <body>

    <!-- 3. р╕Ыр╕╕р╣Ир╕б Link р╣Др╕Ы Google Sheet -->
    <a id="sheetLink" href="#" target="_blank" class="sheet-link-btn">
      <i class="bi bi-file-earmark-spreadsheet-fill"></i> р╣Ар╕Ыр╕┤р╕Ф Sheet
    </a>

    <div id="page-add" class="container page-section active">
      <div class="card mt-4">
        <h2>тЬи р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕гр╕▓р╕вр╕гр╕▒р╕Ъ-р╕Ир╣Ир╕▓р╕в</h2>
        <form id="myForm" onsubmit="handleFormSubmit(this)">
          <div class="d-flex justify-content-center mb-3">
            <input type="radio" class="btn-check" name="type" id="income" value="р╕гр╕▓р╕вр╕гр╕▒р╕Ъ" autocomplete="off">
            <label class="btn btn-outline-primary me-2 rounded-pill px-4" for="income">р╕гр╕▓р╕вр╕гр╕▒р╕Ъ ЁЯТ░</label>
            <input type="radio" class="btn-check" name="type" id="expense" value="р╕гр╕▓р╕вр╕Ир╣Ир╕▓р╕в" autocomplete="off" checked>
            <label class="btn btn-outline-danger rounded-pill px-4" for="expense">р╕гр╕▓р╕вр╕Ир╣Ир╕▓р╕в ЁЯТ╕</label>
          </div>
          <div class="mb-3">
            <label class="form-label">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
            <input type="text" class="form-control" name="date" required id="datePicker" placeholder="р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И">
          </div>
          <div class="mb-3">
            <label class="form-label">р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И</label>
            <select class="form-select" name="category">
              <option value="р╕нр╕▓р╕лр╕▓р╕г">ЁЯНЬ р╕нр╕▓р╕лр╕▓р╕г</option>
              <option value="р╕Вр╕нр╕Зр╣Гр╕Кр╣Йр╕Кр╕╡р╕зр╕┤р╕Хр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ">ЁЯз╗ р╕Вр╕нр╕Зр╣Гр╕Кр╣Йр╕Кр╕╡р╕зр╕┤р╕Хр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</option>
              <option value="р╕кр╕▒р╕Хр╕зр╣Мр╣Ар╕ер╕╡р╣Йр╕вр╕З">ЁЯР▒ р╕кр╕▒р╕Хр╕зр╣Мр╣Ар╕ер╕╡р╣Йр╕вр╕З</option>
              <option value="р╕лр╕Щр╕╡р╣Йр╕кр╕┤р╕Щ">ЁЯТ│ р╕лр╕Щр╕╡р╣Йр╕кр╕┤р╕Щ</option>
              <option value="р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з">ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з</option>
              <option value="р╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з">ЁЯТЕ р╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з</option>
              <option value="р╕гр╕▓р╕вр╣Др╕Фр╣Й">ЁЯТ╡ р╕гр╕▓р╕вр╣Др╕Фр╣Й</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф</label>
            <input type="text" class="form-control" name="detail" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Вр╣Йр╕▓р╕зр╕бр╕▒р╕Щр╣Др╕Бр╣И">
          </div>
          <div class="mb-4">
            <label class="form-label">р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ</label>
            <input type="number" class="form-control" name="amount" placeholder="0.00" required inputmode="decimal">
          </div>
          <button type="submit" class="btn btn-save">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</button>
          <div id="message" class="mt-3 text-center" style="display:none; color:#6B8E23;"></div>
        </form>
      </div>
    </div>

    <div id="page-stats" class="container page-section">
      <div class="card mt-4">
        <h4>ЁЯУК р╕ар╕▓р╕Юр╕гр╕зр╕бр╕Бр╕▓р╕гр╣Ар╕Зр╕┤р╕Щ</h4>
        
        <!-- 1. р╕кр╣Ир╕зр╕Щр╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕зр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И (Start - End) -->
        <div class="row g-2 mb-3 align-items-end p-2 bg-light rounded">
          <div class="col-5">
            <label class="small text-muted">р╕Хр╕▒р╣Йр╕Зр╣Бр╕Хр╣Ир╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
            <input type="text" id="startDate" class="form-control form-control-sm text-center bg-white" placeholder="р╕зр╕з/р╕Фр╕Ф/р╕Ыр╕Ыр╕Ыр╕Ы">
          </div>
          <div class="col-5">
            <label class="small text-muted">р╕Цр╕╢р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
            <input type="text" id="endDate" class="form-control form-control-sm text-center bg-white" placeholder="р╕зр╕з/р╕Фр╕Ф/р╕Ыр╕Ыр╕Ыр╕Ы">
          </div>
          <div class="col-2">
             <button onclick="loadDashboard()" class="btn btn-sm btn-primary w-100 h-100" style="max-height: 31px;">
               <i class="bi bi-search"></i>
             </button>
          </div>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-4">
            <div class="summary-box bg-income">
              <small>р╕гр╕▓р╕вр╕гр╕▒р╕Ъ</small><br><span id="totalIncome">0</span>
            </div>
          </div>
          <div class="col-4">
            <div class="summary-box bg-expense">
              <small>р╕гр╕▓р╕вр╕Ир╣Ир╕▓р╕в</small><br><span id="totalExpense">0</span>
            </div>
          </div>
          <div class="col-4">
            <div class="summary-box bg-balance">
              <small>р╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н</small><br><span id="totalBalance">0</span>
            </div>
          </div>
        </div>
        <div style="position: relative; height:250px; width:100%; margin-bottom:20px;">
          <canvas id="expenseChart"></canvas>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-3">
            <h6 class="text-muted mb-0">ЁЯУЭ р╕гр╕▓р╕вр╕Бр╕▓р╕г (р╣Гр╕Щр╕Кр╣Ир╕зр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б)</h6>
        </div>
        <ul class="list-group list-group-flush mt-2" id="recentList" style="font-size: 0.9rem;"></ul>
      </div>
    </div>

    <!-- 2. Modal р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Бр╣Йр╣Др╕Вр╕Вр╣Йр╕нр╕бр╕╣р╕е -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 20px;">
          <div class="modal-header bg-light">
            <h5 class="modal-title" style="color:#555;">тЬПя╕П р╣Бр╕Бр╣Йр╣Др╕Вр╕гр╕▓р╕вр╕Бр╕▓р╕г</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editForm" onsubmit="handleEditSubmit(this)">
              <!-- Hidden Field р╣Ар╕Бр╣Зр╕Ъ Index р╕Вр╕нр╕Зр╣Бр╕Цр╕з -->
              <input type="hidden" name="rowIndex" id="editRowIndex">
              
              <div class="d-flex justify-content-center mb-3">
                <input type="radio" class="btn-check" name="type" id="editIncome" value="р╕гр╕▓р╕вр╕гр╕▒р╕Ъ">
                <label class="btn btn-sm btn-outline-primary me-2 rounded-pill px-3" for="editIncome">р╕гр╕▓р╕вр╕гр╕▒р╕Ъ</label>
                <input type="radio" class="btn-check" name="type" id="editExpense" value="р╕гр╕▓р╕вр╕Ир╣Ир╕▓р╕в">
                <label class="btn btn-sm btn-outline-danger rounded-pill px-3" for="editExpense">р╕гр╕▓р╕вр╕Ир╣Ир╕▓р╕в</label>
              </div>

              <div class="mb-2">
                <label class="small text-muted">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
                <input type="text" class="form-control" name="date" id="editDatePicker" required>
              </div>
              <div class="mb-2">
                <label class="small text-muted">р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И</label>
                <select class="form-select" name="category" id="editCategory">
                  <option value="р╕нр╕▓р╕лр╕▓р╕г">ЁЯНЬ р╕нр╕▓р╕лр╕▓р╕г</option>
                  <option value="р╕Вр╕нр╕Зр╣Гр╕Кр╣Йр╕Кр╕╡р╕зр╕┤р╕Хр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ">ЁЯз╗ р╕Вр╕нр╕Зр╣Гр╕Кр╣Йр╕Кр╕╡р╕зр╕┤р╕Хр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</option>
                  <option value="р╕кр╕▒р╕Хр╕зр╣Мр╣Ар╕ер╕╡р╣Йр╕вр╕З">ЁЯР▒ р╕кр╕▒р╕Хр╕зр╣Мр╣Ар╕ер╕╡р╣Йр╕вр╕З</option>
                  <option value="р╕лр╕Щр╕╡р╣Йр╕кр╕┤р╕Щ">ЁЯТ│ р╕лр╕Щр╕╡р╣Йр╕кр╕┤р╕Щ</option>
                  <option value="р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з">ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з</option>
                  <option value="р╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з">ЁЯТЕ р╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з</option>
                  <option value="р╕гр╕▓р╕вр╣Др╕Фр╣Й">ЁЯТ╡ р╕гр╕▓р╕вр╣Др╕Фр╣Й</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="small text-muted">р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф</label>
                <input type="text" class="form-control" name="detail" id="editDetail">
              </div>
              <div class="mb-3">
                <label class="small text-muted">р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ</label>
                <input type="number" class="form-control" name="amount" id="editAmount" required step="any">
              </div>
              <button type="submit" class="btn btn-save" style="font-size: 1rem;">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <div class="nav-item active" onclick="switchPage('page-add', this)">
        <i class="bi bi-plus-circle-fill"></i><span>р╕Ир╕Фр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</span>
      </div>
      <div class="nav-item" onclick="switchPage('page-stats', this)">
        <i class="bi bi-pie-chart-fill"></i><span>р╕кр╕гр╕╕р╕Ыр╕Ьр╕е</span>
      </div>
    </div>

    <?!= include('JavaScript'); ?>
  </body>
</html>
